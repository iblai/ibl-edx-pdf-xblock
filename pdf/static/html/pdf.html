<div class="pdf_block_iframe">
  <iframe id="unit-iframe" title="pdf" src="{href}" width="100%" height="603" frameBorder="0" allow="microphone *; camera *; midi *; geolocation *; encrypted-media *" allowfullscreen="" scrolling="no" referrerpolicy="origin">
    <p>It appears you don't have a PDF plugin for this browser.
      You can <a href="{href}">click here to
      download the PDF file.</a></p>
  </iframe>
</div>

<div class="pdf_block">
  <div id="pdf-loader">Loading document...</div>
  <div id="pdf-container"></div>
  <!-- PDF Download Button -->

  <ul>
    <li class="pdf-download-button">
      <a id="pdf_download" href="" download="" class="pdf-download-button">Download PDF File</a>
    </li>
  </ul>
</div>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js"></script>

<script>

function hideElement(selector) {
  var element = document.querySelector(selector);
  if (element) {
    element.style.display = 'none';
  }
}

function initializePDFLoading(href) {
  if (!href) {
    console.error("Error: href is undefined or null. Check the path to your PDF.");
  } else {
    loadPDF(href);
  }
}


if (window.location.hostname.startsWith('studio.')) {
  console.log('Hostname starts with studio.');
  // Hide pdf_block immediately if DOM is ready, or wait for it.
  if (document.readyState === "loading") {
    console.log('Document is loading. Setting up DOMContentLoaded listener for studio.');
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOMContentLoaded for studio. Hiding .pdf_block.');
      hideElement('.pdf_block');
    });
  } else {
    console.log('Document already loaded for studio. Hiding .pdf_block.');
    hideElement('.pdf_block');
  }
} else if (navigator.userAgent.toLowerCase().includes('firefox') || navigator.userAgent.toLowerCase().includes('mozilla')) {
  console.log('Browser is Firefox/Mozilla.');
  // Hide pdf_block for Firefox/Mozilla browsers.
  if (document.readyState === "loading") {
    console.log('Document is loading. Setting up DOMContentLoaded listener for Firefox/Mozilla.');
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOMContentLoaded for Firefox/Mozilla. Hiding .pdf_block.');
      hideElement('.pdf_block');
    });
  } else {
    console.log('Document already loaded for Firefox/Mozilla. Hiding .pdf_block.');
    hideElement('.pdf_block');
  }
} else {
  console.log('Neither studio hostname nor Firefox/Mozilla browser detected.');
  var href = "{href}"; // Ensure this is the correct path to your PDF

  if (document.readyState === "loading") {
    console.log('Document is loading. Setting up DOMContentLoaded listener for other cases.');
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOMContentLoaded for other cases. Executing setup.');
      hideElement('.pdf_block_iframe');
      initializePDFLoading(href);
      adjustCanvasSize();
      window.addEventListener('resize', adjustContainerMaxHeight);
      window.addEventListener('resize', adjustCanvasSize);
      setupPdfDownloadButton(href);

      const downloadButton = document.getElementById('pdf_download');
      console.log('Setting up download button listener.');
      downloadButton.addEventListener('click', function(event) {
          event.preventDefault();
          console.log('Download button clicked. Preparing to download PDF.');
          //setupPdfDownloadButton(href); // This seems to be a redundant call given the context.
          downloadButton.click();
      });
    });
  } else {
    console.log('Document already loaded for other cases. Executing setup.');
    hideElement('.pdf_block_iframe');
    initializePDFLoading(href);
  }

  document.addEventListener('DOMContentLoaded', function() {
    const downloadButton = document.getElementById('pdf_download');
    console.log('Setting up download button listener outside initial check.');
    downloadButton.addEventListener('click', function(event) {
        event.preventDefault();
        console.log('Download button clicked outside initial check. Preparing to download PDF.');

        const pdfUrl = href; // Use the actual PDF URL
        const fileName = pdfUrl.split('/').pop(); // Extracts the filename from the URL

        downloadButton.href = pdfUrl;
        downloadButton.download = fileName;

        downloadButton.click();
    });
  });
}
</script>
